#!/usr/bin/env bash

# Usage:
# ^rx,y,w,h^: Draw a rectangle of width w and height h, with its top left corner at (x,y) relative the X drawing cursor.
# ^c#FF0000^: Set foreground color.
# ^b#55cdfc^: Set background color, only applies to text, simply use the ^r^ command to change the background while drawing.
# ^f^: Forward the X drawing cursor by pixel. Please bear in mind that you have to move the cursor enough to display your drawing (by the with of your drawing).
# ^d^: Reset colors to SchemeNorm.

get_ps_count() {
	echo -n ' '
	ps --no-headers -U $USER -u $USER u | wc -l | tr '\n' ' '
}

get_keyboard_layout() {
	if [[ "$(skb -1)" == "Eng" ]]; then
		echo -en "^b#268BD2^^c#eee8d5^ EN ^d^"
	else
		echo -en "^b#B58900^^c#fdf6e3^ RU ^d^"
	fi
}

get_date() {
	echo -en "^b#073642^ $(date +'%d/%b/%Y [%a] Ð”=%j ^c#eee8d5^%H:%M')^d^^b#073642^ ^d^"
}

get_battery() {
	local value=$(cat /sys/class/power_supply/BAT0/capacity)
	local color
	if [[ "${value}" -le 30 ]]; then
		color="^b#dc322f^^c#eee8d5^"
	elif [[ "${value}" -le 70 ]]; then
		color="^c#93a1a1^"
	else
		color="^b#859900^^c#fdf6e3^"
	fi
	echo -en "${color} ${value}% ^d^"
}

while true; do
	xsetroot -name "$(get_date)$(get_keyboard_layout)$(get_ps_count)"
	sleep 1
done
